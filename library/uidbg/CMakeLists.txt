PROJECT(uidbg LANGUAGES CXX)

SET(CMAKE_AUTOUIC ON)
SET(CMAKE_AUTOMOC ON)
SET(CMAKE_AUTORCC ON)

FIND_PACKAGE(QT NAMES Qt6 Qt5 REQUIRED COMPONENTS Gui Widgets )
FIND_PACKAGE(Qt${QT_VERSION_MAJOR} REQUIRED COMPONENTS Gui Widgets )

SET(SOURCE_LIST
  dbggenericplugin.h dbggenericplugin.cpp
  objecttreewidget.h objecttreewidget.cpp
  consolewidget.h consolewidget.cpp
  spotwidget.h spotwidget.cpp
  propertyitemdelegate.h propertyitemdelegate.cpp
  propparser.h propparser.cpp
  tools.h tools.cpp
  ${PROJECT_NAME}.json
)
ADD_LIBRARY(${PROJECT_NAME} SHARED ${SOURCE_LIST})

SOURCE_GROUP(TREE ${CMAKE_CURRENT_SOURCE_DIR} FILES ${SOURCE_LIST})

SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES DEBUG_POSTFIX "d")

TARGET_INCLUDE_DIRECTORIES(${PROJECT_NAME} BEFORE PRIVATE ${CMAKE_BINARY_DIR_INCLUDE}/lite)
TARGET_LINK_LIBRARIES(${PROJECT_NAME} PRIVATE Qt${QT_VERSION_MAJOR}::Gui Qt${QT_VERSION_MAJOR}::Widgets)
TARGET_COMPILE_DEFINITIONS(${PROJECT_NAME} PRIVATE UIDBG_LIBRARY)

ADD_CUSTOM_COMMAND(
  TARGET ${PROJECT_NAME}
  POST_BUILD
	COMMAND ${CMAKE_COMMAND} -E copy_if_different $<TARGET_FILE:${PROJECT_NAME}> 
    $<TARGET_FILE_DIR:${PROJECT_NAME}>/QtPlugins/generic/$<TARGET_FILE_NAME:${PROJECT_NAME}>
	COMMAND ${CMAKE_COMMAND} -E rm -f $<TARGET_FILE:${PROJECT_NAME}>
)

#X_ADDTASK_DEPLOY_QT(TARGET ${PROJECT_NAME})
